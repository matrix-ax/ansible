---

redis:
  enabled: true
{% if 'appservice' in synapse_workers %}
notify_appservices: false
{% endif %}
{% if 'pusher' in synapse_workers %}
start_pushers: false
{% endif %}
{% if 'user_dir' in synapse_workers %}
update_user_directory: false
{% endif %}


{% if 'media_repository' in synapse_workers %}
enable_media_repo: false
{% endif %}
{% if 'event_persister' in synapse_workers %}
instance_map:
{% for port in synapse_workers.event_persister %}
  event_persister-{{ loop.index0 }}:
    host: localhost
    port: {{ port }}
{% endfor %}

stream_writers:
  events:
{% for port in synapse_workers.event_persister %}
    - event_persister-{{ loop.index0 }}
{% endfor %}
{% endif %}

{% if 'federation_sender' in synapse_workers %}
send_federation: false

{% if synapse_workers.federation_sender|length > 1 %}
federation_sender_instances:
{% for port in synapse_workers.federation_sender %}
  - federation_sender-{{ loop.index0 }}
{% endfor %}
{% endif %}

{% endif %}
